{"version":3,"names":[],"mappings":"","sources":["devicelog/factories/device-dao-factory.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('devicelog')\n    .factory('DeviceDAO', DeviceDAO);\n\n  DeviceDAO.$inject = ['$q', 'InApiUtils', 'DataAdapter'];\n\n  function DeviceDAO($q, InApiUtils, DataAdapter) {\n    var service = {}, apiUrls, devicesPageInfoList = {}, devicesInfoCache = {}, MAX_PAGE_SIZE = 50;\n\n    apiUrls = {\n      deviceList: '/api/ifa/1/device/list'\n    };\n\n    function getDeviceList(un, pageNbr, pageSize, flagReload) {\n      var defer = $q.defer(), urlParams, devicesPageInfo;\n\n      devicesPageInfo = devicesPageInfoList[un] || {};\n\n      if (!un && devicesInfoCache && devicesInfoCache.devices && devicesInfoCache.devices.length > 0) {\n        defer.resolve(devicesInfoCache);\n      } else if (devicesPageInfo.devices && devicesPageInfo.devices.length > 0 && !flagReload) {\n        defer.resolve(devicesPageInfo);\n      } else if (un) {\n        /* jshint camelcase:false */\n        /* eslint camelcase:0 */\n        urlParams = {\n          apsystem: 'IFA',\n          user_id: un,\n          limit: parseInt(pageSize, 10) || MAX_PAGE_SIZE,\n          page_number: parseInt(pageNbr, 10) || 1\n        };\n\n        DataAdapter.requestApiSvrPassword(un, 'GET', apiUrls.deviceList, urlParams)\n          .then(function (resData) {\n            if (resData && resData.err && resData.err.code === '0') {\n              resData = InApiUtils.camelizeObj(resData);\n              devicesPageInfoList[un] = resData;\n              devicesInfoCache = resData;\n              defer.resolve(resData);\n            } else {\n              defer.reject(resData);\n            }\n          }, function (resData) {\n            defer.reject(resData);\n          });\n      } else {\n        defer.resolve({\n          devices: []\n        });\n      }\n\n      return defer.promise;\n    }\n\n    function destroy() {\n      devicesPageInfoList = {};\n      devicesInfoCache = {};\n    }\n\n    service.getDeviceList = getDeviceList;\n    service.destroy = destroy;\n\n    return service;\n  }\n}());\n"],"file":"device-dao-factory.js"}