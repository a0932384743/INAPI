{"version":3,"names":[],"mappings":"","sources":["devicelog/constrollers/devicelog-5-2-add-resource-controller.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('devicelog')\n    .controller('AddResourceCtrl', Ctrl);\n\n  Ctrl.$inject = ['dialogs', '$modalInstance', 'InApiUtils', 'ValidationSummary', 'ResourceDAO', 'data'];\n\n  function Ctrl(dialogs, $modalInstance, InApiUtils, ValidationSummary, ResourceDAO, data) {\n    var vm = this;\n\n    vm.un = data.un || '';\n    vm.lockUn = vm.un ? true : false;\n    vm.isSending = false;\n\n    function validateForm() {\n      var un = vm.un || '', pwd = vm.pwd || '', summary = ValidationSummary;\n\n      summary.clear();\n\n      if (!un) {\n        summary.push('擁有者帳號不得為空');\n      }\n\n      if (!pwd) {\n        summary.push('擁有者密碼不得為空');\n      }\n\n      if (summary.count() > 0) {\n        dialogs.notify('表單驗證錯誤', summary.flush());\n        return false;\n      }\n\n      return true;\n    }\n\n    function handleErrCode(err) {\n      err = err || {code: ''};\n\n      switch (err.code) {\n        case '400':\n          dialogs.notify('授權失敗', '密碼有誤，請重新輸入。');\n          vm.pwd = '';\n          break;\n        case '7000':\n          dialogs.notify('授權失敗', '伺服器發生錯誤');\n          break;\n        case '7100':\n          dialogs.notify('授權失敗', '表單參數有誤，請確認後再行送出。');\n          break;\n        default:\n          dialogs.notify(\n            '授權失敗',\n            InApiUtils.stringFormat('發生未知錯誤，錯誤代碼：{0}<br/>錯誤訊息：{1}', err.code, err.msg)\n          );\n          break;\n      }\n    }\n\n    function cancel() {\n      $modalInstance.dismiss('close');\n    }\n\n    function doSubmit() {\n      if (validateForm()) {\n        vm.isSending = true;\n\n        ResourceDAO.doLogin(vm.un, vm.pwd)\n          .then(function (res) {\n            // 將資料回傳主視窗\n            dialogs.notify('新增成功', '已取得資源擁有者授權');\n            $modalInstance.close(res.un);\n          }, function (resData) {\n            handleErrCode(resData.err);\n          })\n          .finally(function () {\n            vm.isSending = false;\n          });\n      }\n\n      return false;\n    }\n\n    vm.cancel = cancel;\n    vm.doSubmit = doSubmit;\n\n    return vm;\n  }\n}());\n"],"file":"devicelog-5-2-add-resource-controller.js"}