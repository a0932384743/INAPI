{"version":3,"names":[],"mappings":"","sources":["account/controllers/account-8-1-user-info-controller.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('account')\n    .controller('AccountUserInfoCtrl', Ctrl);\n\n  Ctrl.$inject = ['$scope', '$filter', '$state', '$stateParams', 'dialogs', 'InApiUtils', 'AccountDAO'];\n\n  function Ctrl($scope, $filter, $state, $stateParams, dialogs, InApiUtils, AccountDAO) {\n    var vm = this;\n\n    vm.isUserIdInvalid = true;\n    vm.clientId = vm.clientSecret = '載入中...';\n\n    function init() {\n      var queue;\n\n      queue = AccountDAO.getMyInfo()\n        .then(function (me) {\n          vm.userId = me.userId;\n          vm.userName = me.userName;\n          vm.userEmail = me.email;\n          vm.updateTime = $filter('date')(new Date(me.updateTime), 'yyyy-MM-dd HH:mm:ss');\n          vm.isUserIdInvalid = false;\n\n          return AccountDAO.doRetrieveCredential('DPA', me.userId);\n        }, function (resData) {\n          dialogs.notify(\n            '取得登入人員資料錯誤',\n            InApiUtils.stringFormat('錯誤代碼：{0}, <br />錯誤訊息：{1}', resData.err.code, resData.err.msg)\n          );\n        });\n\n      queue.then(function (credential) {\n        vm.clientId = credential.clientId;\n        vm.clientSecret = credential.clientSecret;\n      }, function (resData) {\n        dialogs.notify(\n          '取得認證資料錯誤',\n          InApiUtils.stringFormat('錯誤代碼：{0}, <br />錯誤訊息：{1}', resData.err.code, resData.err.msg)\n        );\n      });\n    }\n\n    function editUserName() {\n      var data = {\n        userName: vm.userName || ''\n      };\n\n      dialogs.create(\n        'account/views/account-8-2-change-username.tpl.html',\n        'ChangeUserNameCtrl as vm',\n        data,\n        {size: 'lg'}\n      ).result.then(function (userName) {\n        vm.userName = userName;\n        $scope.$broadcast('change:userDisplayName', userName);\n      }).finally(function () {\n        $state.transitionTo($state.current, $stateParams, {\n          reload: true,\n          inherit: false,\n          notify: true\n        });\n      });\n    }\n\n    function editEmail() {\n      var data = {\n        userEmail: vm.userEmail || ''\n      };\n\n      dialogs.create(\n        'account/views/account-8-3-change-email.tpl.html',\n        'ChangeEmailCtrl as vm',\n        data,\n        {size: 'lg'}\n      ).result.then(function (email) {\n        vm.userEmail = email;\n      }).finally(function () {\n        $state.transitionTo($state.current, $stateParams, {\n          reload: true,\n          inherit: false,\n          notify: true\n        });\n      });\n    }\n\n    function editPwd() {\n      dialogs.create(\n        'account/views/account-8-4-change-pwd.tpl.html',\n        'ChangePwdCtrl as vm',\n        {},\n        {size: 'lg'}\n      ).result.finally(function () {\n        $state.transitionTo($state.current, $stateParams, {\n          reload: true,\n          inherit: false,\n          notify: true\n        });\n      });\n    }\n\n    init();\n\n    vm.editUserName = editUserName;\n    vm.editEmail = editEmail;\n    vm.editPwd = editPwd;\n\n    return vm;\n  }\n}());\n"],"file":"account-8-1-user-info-controller.js"}