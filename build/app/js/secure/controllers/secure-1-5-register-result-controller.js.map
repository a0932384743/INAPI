{"version":3,"names":[],"mappings":"","sources":["secure/controllers/secure-1-5-register-result-controller.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('secure')\n    .controller('SecureRegisterResultCtrl', Ctrl);\n\n  Ctrl.$inject = ['$state', '$translate', 'dialogs', 'APP_CONFIG', 'StorageAPI', 'InApiUtils', 'SecureAuth'];\n\n  function Ctrl($state, $translate, dialogs, APP_CONFIG, StorageAPI, InApiUtils, SecureAuth) {\n    var vm = this, userId = StorageAPI.getMyUserId() || '';\n\n    vm.isSending = false;\n\n    function authCheck() {\n      if (!userId) {\n        $state.go(APP_CONFIG.homeState);\n      }\n    }\n\n    function handleErrCode(err) {\n      err = err || {code: ''};\n\n      switch (err.code) {\n        case '0':\n          dialogs.notify('重發認證信件成功', '已將認證信件寄至您的信箱<br />請於認證後再進行登入');\n          break;\n        case '7000':\n          dialogs.notify('重發認證信件失敗', '伺服器發生錯誤，請稍後再次提交表單。');\n          break;\n        case '7100':\n          dialogs.notify('重發認證信件失敗', '提交資訊有誤。');\n          break;\n        default:\n          dialogs.notify('重發認證信件失敗',\n            InApiUtils.stringFormat('發生未知錯誤，錯誤代碼：{0}, 錯誤訊息：{1}', err.code, err.msg));\n      }\n    }\n\n    function doSubmit() {\n      var backUrl, postParams;\n\n      backUrl = SecureAuth.getUserVerifyBackUrl(userId);\n\n      /* jshint camelcase:false */\n      /* eslint camelcase:0 */\n      postParams = {\n        this_user_id: userId,\n        this_apsystem: 'DPA',\n        mail_subject: $translate.instant('RESEND_REG_MAIL_SUBJECT'),\n        mail_content: InApiUtils.stringFormat($translate.instant('RESEND_REG_MAIL_CONTENT'), backUrl)\n      };\n\n      vm.isSending = true;\n\n      SecureAuth.doResendVerification(postParams)\n        .then(function (resData) {\n          handleErrCode(resData.err);\n        }, function () {\n          dialogs.notify('重發認證信件失敗', '伺服器拒絕存取，請稍後再試。');\n        }).finally(function () {\n          vm.isSending = false;\n        });\n    }\n\n    function confirmToResend() {\n      var msgContent = InApiUtils.stringFormat(\n        '<div class=\"popup-text\"><p>是否確定要重發認證信件至<br />[{0}]</p></div>',\n        userId\n      );\n\n      dialogs.confirm('重發認證信件', msgContent)\n        .result.then(function () {\n          doSubmit();\n        });\n    }\n\n    authCheck();\n\n    vm.go = $state.go;\n    vm.confirmToResend = confirmToResend;\n\n    return vm;\n  }\n}());\n"],"file":"secure-1-5-register-result-controller.js"}