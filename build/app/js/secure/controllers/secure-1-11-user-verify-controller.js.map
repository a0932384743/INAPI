{"version":3,"names":[],"mappings":"","sources":["secure/controllers/secure-1-11-user-verify-controller.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('secure')\n    .controller('SecureUserVerifyCtrl', Ctrl);\n\n  Ctrl.$inject = ['$state', '$location', 'dialogs', 'base64', 'APP_CONFIG', 'StorageAPI', 'InApiUtils', 'SecureAuth'];\n\n  function Ctrl($state, $location, dialogs, base64, APP_CONFIG, StorageAPI, InApiUtils, SecureAuth) {\n    var vm = this, urlParams, encodedUn, code;\n\n    urlParams = $location.search() || {};\n    encodedUn = urlParams.un || '';\n    code = urlParams.code || '';\n\n    function authCheck() {\n      if (!encodedUn || encodedUn === '' || !code || code === '') {\n        $state.go(APP_CONFIG.homeState);\n        return false;\n      }\n\n      return true;\n    }\n\n    function handleErrCode(err) {\n      err = err || {code: ''};\n\n      switch (err.code) {\n        case '0':\n          StorageAPI.setFlagUserVerified(true);\n          $state.go('secure.user-verify-success');\n          return;\n        case '7000':\n          dialogs.notify('開發者會員帳號認證失敗', '伺服器發生錯誤。');\n          break;\n        case '7100':\n          dialogs.notify('開發者會員帳號認證失敗', '無效的參數。');\n          break;\n        case '7110':\n          dialogs.notify('開發者會員帳號認證失敗', '無效的帳號。');\n          break;\n        case '7113':\n          dialogs.notify('開發者會員帳號認證失敗', '無效的驗證碼。');\n          break;\n        default:\n          dialogs.notify(\n            '認證開發者會員帳號失敗',\n            InApiUtils.stringFormat('發生未知錯誤，錯誤代碼：{0}, 錯誤訊息：{1}', err.code, err.msg)\n          );\n      }\n\n      $state.go(APP_CONFIG.homeState);\n    }\n\n    function doSubmit() {\n      /* jshint camelcase:false */\n      /* eslint camelcase:0 */\n      var postParams = {\n        this_user_id: base64.decode(encodedUn),\n        this_apsystem: 'DPA',\n        code: code\n      };\n\n      SecureAuth.doVerifyUser(postParams)\n        .then(function (resData) {\n          handleErrCode(resData.err);\n        }, function () {\n          dialogs.notify('開發者會員帳號認證失敗', '伺服器拒絕存取，請稍後再試。');\n        });\n    }\n\n    if (authCheck()) {\n      SecureAuth.doLogout();\n      doSubmit();\n    }\n\n    return vm;\n  }\n}());\n"],"file":"secure-1-11-user-verify-controller.js"}